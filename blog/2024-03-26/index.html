<!DOCTYPE html><html  lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Metro Travel</title><style>/*! tailwindcss v4.1.11 | MIT License | https://tailwindcss.com */@layer properties{@supports ((-webkit-hyphens:none) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,::backdrop,:after,:before{--tw-font-weight:initial;--tw-leading:initial}}}.post h1{font-size:var(--text-4xl,2.25rem);line-height:var(--tw-leading,var(--text-4xl--line-height,1.11111));--tw-font-weight:var(--font-weight-bold,700);color:var(--color-gray-900,oklch(21% .034 264.665));font-weight:var(--font-weight-bold,700);padding-bottom:2rem}.post h2{font-size:var(--text-3xl,1.875rem);line-height:var(--tw-leading,var(--text-3xl--line-height,1.2));--tw-font-weight:var(--font-weight-semibold,600);color:var(--color-gray-800,oklch(27.8% .033 256.848));font-weight:var(--font-weight-semibold,600)}.post p{font-size:var(--text-base,1rem);line-height:var(--tw-leading,var(--text-base--line-height,1.5));--tw-leading:var(--leading-relaxed,1.625);color:var(--color-gray-700,oklch(37.3% .034 259.733));line-height:var(--leading-relaxed,1.625)}.post ul{list-style-position:inside;list-style-type:disc}.post a{color:var(--color-blue-600,oklch(54.6% .245 262.881));text-decoration-line:underline}@media (hover:hover){.post a:hover{color:var(--color-blue-800,oklch(42.4% .199 265.638))}}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-leading{syntax:"*";inherits:false}</style><style>pre code .line{display:block}</style><link rel="stylesheet" href="/_nuxt/entry.D0eQ7gLW.css" crossorigin><link rel="preload" as="fetch" crossorigin="anonymous" href="/blog/2024-03-26/_payload.json?d002b2d4-7063-42d0-8888-5547bfabd298"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/xtOTLKHp.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/B6OLWuwh.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/p1vkQy-1.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CBzfIoK6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DecUcFKb.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DTXG7hKP.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/B1jbzOwC.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CoIEo3mS.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CFUHJ3Jn.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BVyUBhLY.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/D-hlhtvc.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Thq6mFJM.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BcB6_aqD.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CL5PJvcM.js"><link rel="preload" as="fetch" fetchpriority="low" crossorigin="anonymous" href="/_nuxt/builds/meta/d002b2d4-7063-42d0-8888-5547bfabd298.json"><script src="https://analytics.vincenthardouin.dev/js/script.js" defer data-domain="metro-travel.vincenthardouin.dev"></script><link rel="prefetch" as="script" crossorigin href="/_nuxt/Cnsg1qAK.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DOw0PMhc.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DAzw92B2.js"><meta hid="description" name="description" content="D√©fiez vos connaissances du m√©tro parisien chaque jour en trouvant le trajet optimal."><meta name="keywords" content="metro, paris, travel, challenge, game, daily, GTFS"><meta name="author" content="Vincent Hardouin"><meta name="robots" content="index, follow"><meta name="og:title" content="Metro travel"><link rel="icon" type="image/png" href="/favicon.png"><script type="module" src="/_nuxt/xtOTLKHp.js" crossorigin></script><script id="unhead:payload" type="application/json">{"title":"Metro Travel"}</script></head><body><div id="__nuxt"><div><body class="bg-gray-100 dark:bg-gray-900 font-sans transition-colors duration-300"><header class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-lg px-3 py-3 rounded-full shadow-lg flex justify-between items-center z-10 w-[calc(100%-2rem)] max-w-[640px] mx-auto transition-colors duration-300"><div class="text-m md:text-lg font-bold text-gray-800 dark:text-gray-200 whitespace-nowrap px-1 md:px-3"> üöá Metro Travel </div><div class="flex items-center gap-2 md:gap-6"><ul class="hidden sm:flex gap-2 md:gap-4 items-center"><li><a href="/" class="text-sm md:text-base font-medium hover:text-primary no-underline"> Accueil </a></li><li><a href="/blog" class="text-sm md:text-base font-medium hover:text-primary no-underline"> Blog </a></li></ul><a href="/training" class="btn btn-primary btn-sm shadow-none px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap"> S&#39;entra√Æner </a></div></header><!--[--><article class="post max-w-3xl mx-auto pt-34 py-12 px-4 prose prose-gray dark:prose-invert prose prose-lg dark:prose-invert leading-relaxed"><div><h1 id="_2024-03-26"><!--[-->2024-03-26<!--]--></h1><p><!--[-->Bon qu&#39;est-ce que je souhaite faire et pour faire quoi ?<!--]--></p><p><!--[-->Actuellement, l&#39;application prend en charge les lignes de m√©tro de Paris, et permet de calculer un itin√©raire entre deux
stations en fonction du nombre de stations. C&#39;est un peu simpliste, mais √ßa fonctionne.<!--]--></p><p><!--[-->J&#39;aimerais ajouter la possibilit√© de jouer avec le trajet le plus rapide, et le moins de correspondance.
Pour la premi√®re partie, il me faut le temps entre chaque station, et le temps de correspondance dans une station.<!--]--></p><p><!--[-->Pour avoir cette information, je vais devoir utiliser les donn√©es d&#39;√éle-de-France Mobilit√©s, et plus particuli√®rement
le General Transit Feed Specification (GTFS) dans sa version schedule.<!--]--></p><p><!--[-->Je vais devoir utiliser les donn√©es, c&#39;est clairement du relationnel, et je vais devoir faire des jointures entre les
diff√©rents fichiers.
Est-ce que je vais devoir utiliser une BDD pour √ßa ? Franchement, je pense que les requ√™tes peuvent me simplifier la
vie.<!--]--></p><p><!--[-->Je trouve <a href="https://docs.mobilitydb.com/MobilityDB-workshop/master/ch04.html#idp22" rel="nofollow"><!--[-->un article<!--]--></a> qui donne les sch√©mas √†
cr√©er pour PostgreSQL et les √©tapes pour copier les donn√©es. C&#39;est ce qu&#39;il me faut.<!--]--></p><p><!--[-->Ce qui m&#39;emb√™te avec les donn√©es d&#39;IDFM, c&#39;est qu&#39;il n&#39;y a pas le fichier
<code><!--[-->shape.txt<!--]--></code>, √ßa me permettrait de tracer les
lignes plus facilement. J&#39;ai par contre bien r√©cup√©r√© les trac√©s des lignes, qui comporte le
<code><!--[-->route_id<!--]--></code>, c&#39;est plut√¥t
ok.<!--]--></p><p><!--[-->Si je r√©sume, pour mon besoin, je charge les fichiers dans ma BDD. Gr√¢ce √† √ßa, je peux faire des requ√™tes pour avoir le
temps entre chaque station et chaque correspondance.<!--]--></p><p><!--[-->Pour me baser que sur le GTFS qu&#39;est-ce qu&#39;il me faut :<!--]--></p><ul><!--[--><li><!--[-->Calculer les stations adjacentes<!--]--></li><li><!--[-->Calculer les portions de lignes √† afficher entre les stations<!--]--></li><!--]--></ul><p><!--[-->Essayons de voir comment je peux faire √ßa.<!--]--></p><ol><!--[--><li><!--[-->Obtenir les stations adjacentes : j&#39;utilise une jointure entre :
<code><!--[-->stop_times<!--]--></code>,
<code><!--[-->trips<!--]--></code>,
<code><!--[-->routes<!--]--></code>. Je ne garde que les
m√©tros :
<code><!--[-->route_type = 1<!--]--></code>. Je fais un distinct
sur
<code><!--[-->trip_headsign<!--]--></code>,
<code><!--[-->direction_id<!--]--></code>,
<code><!--[-->route_id<!--]--></code>,
<code><!--[-->stop_id<!--]--></code>,
<code><!--[-->stop_name<!--]--></code>.<!--]--></li><li><!--[-->Obtenir les portions de lignes √† afficher : Je le fais en JavaScript<!--]--></li><li><!--[-->Obtenir les correspondances : j&#39;utilise une jointure entre
<code><!--[-->pathways<!--]--></code> et
<code><!--[-->stops<!--]--></code>. Je garde le
<code><!--[-->from_stop_id<!--]--></code>,
<code><!--[-->to_stop_id<!--]--></code>,
<code><!--[-->transversal_time<!--]--></code>.<!--]--></li><!--]--></ol><p><!--[-->Cela me parait plut√¥t bon comme plan, je me demande si je vais pas stocker directement la portion avec la station
adjacente.
D&#39;ailleurs est-ce que j&#39;utilise le m√™me vocabulaire :
<code><!--[-->stop<!--]--></code> √† la place de
<code><!--[-->station<!--]--></code> et
<code><!--[-->routes<!--]--></code> √† la place
de
<code><!--[-->lignes<!--]--></code> ?<!--]--></p><p><!--[-->Ce qui me donnerait quelque chose comme :<!--]--></p><pre class="language-json shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sVt8B">{
</span></span><span class="line" line="2"><span class="sj4cs">  &quot;routes&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="3"><span class="sVt8B">    {
</span></span><span class="line" line="4"><span class="sj4cs">      &quot;route_id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;route_id&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="5"><span class="sj4cs">      &quot;route_name&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;route_name&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="6"><span class="sj4cs">      &quot;route_color&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;route_color&quot;
</span></span><span class="line" line="7"><span class="sVt8B">    }
</span></span><span class="line" line="8"><span class="sVt8B">  ],
</span></span><span class="line" line="9"><span class="sj4cs">  &quot;stops&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="10"><span class="sVt8B">    {
</span></span><span class="line" line="11"><span class="sj4cs">      &quot;name&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;stop_name&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="12"><span class="sj4cs">      &quot;id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;stop_id&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="13"><span class="sj4cs">      &quot;route_id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;route_id&quot;
</span></span><span class="line" line="14"><span class="sVt8B">    }
</span></span><span class="line" line="15"><span class="sVt8B">  ],
</span></span><span class="line" line="16"><span class="sj4cs">  &quot;adjacents&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="17"><span class="sVt8B">    {
</span></span><span class="line" line="18"><span class="sj4cs">      &quot;from_stop_id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;stop_id&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="19"><span class="sj4cs">      &quot;to_stop_id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;adjacent_stop_id&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="20"><span class="sj4cs">      &quot;time&quot;</span><span class="sVt8B">: </span><span class="sj4cs">123</span><span class="sVt8B">,
</span></span><span class="line" line="21"><span class="sj4cs">      &quot;path&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="22"><span class="sVt8B">        {
</span></span><span class="line" line="23"><span class="sj4cs">          &quot;lat&quot;</span><span class="sVt8B">: </span><span class="sj4cs">48.123</span><span class="sVt8B">,
</span></span><span class="line" line="24"><span class="sj4cs">          &quot;lon&quot;</span><span class="sVt8B">: </span><span class="sj4cs">2.123
</span></span><span class="line" line="25"><span class="sVt8B">        }
</span></span><span class="line" line="26"><span class="sVt8B">      ]
</span></span><span class="line" line="27"><span class="sVt8B">    }
</span></span><span class="line" line="28"><span class="sVt8B">  ]
</span></span><span class="line" line="29"><span class="sVt8B">}
</span></span></code><!--]--></pre><p><!--[-->Un probl√®me que je vois, c&#39;est quand je vais vouloir ajouter une station, j&#39;aimerais :<!--]--></p><ul><!--[--><li><!--[-->ajouter un unique point sur la carte<!--]--></li><li><!--[-->s&#39;il y a des liaisons, les ajouter<!--]--></li><!--]--></ul><p><!--[-->Mais, en l&#39;√©tat, je ne vois pas comment je choisis la station √† afficher. Il me faut peut-√™tre une liste de stations
sans
relation, qui est uniquement le point √† afficher si la station est seule. Je vais chercher dans les donn√©es.<!--]--></p><p><!--[-->Il y a bien 2 versions :<!--]--></p><ul><!--[--><li><!--[--><a href="https://prim.iledefrance-mobilites.fr/jeux-de-donnees/emplacement-des-gares-idf" rel="nofollow"><!--[-->Gares et stations du r√©seau ferr√© d&#39;√éle-de-France (par ligne) - PRIM IDFM<!--]--></a><!--]--></li><li><!--[--><a href="https://prim.iledefrance-mobilites.fr/jeux-de-donnees/emplacement-des-gares-idf-data-generalisee" rel="nofollow"><!--[-->Gares et stations du r√©seau ferr√© d&#39;√éle-de-France (donn√©e g√©n√©ralis√©e) - PRIM IDFM<!--]--></a><!--]--></li><!--]--></ul><p><!--[-->Cool, √ßa r√©pond √† mon besoin et am√©liora l&#39;application.<!--]--></p><p><!--[-->Donc comment je repr√©sente le json :<!--]--></p><pre class="language-json shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sVt8B">{
</span></span><span class="line" line="2"><span class="sj4cs">  &quot;routes&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="3"><span class="sVt8B">    {
</span></span><span class="line" line="4"><span class="sj4cs">      &quot;route_id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;route_id&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="5"><span class="sj4cs">      &quot;route_name&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;route_name&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="6"><span class="sj4cs">      &quot;route_color&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;route_color&quot;
</span></span><span class="line" line="7"><span class="sVt8B">    }
</span></span><span class="line" line="8"><span class="sVt8B">  ],
</span></span><span class="line" line="9"><span class="sj4cs">  &quot;stops&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="10"><span class="sVt8B">    {
</span></span><span class="line" line="11"><span class="sj4cs">      &quot;name&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;stop_name&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="12"><span class="sj4cs">      &quot;id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;stop_id&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="13"><span class="sj4cs">      &quot;route_id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;route_id&quot;
</span></span><span class="line" line="14"><span class="sVt8B">    }
</span></span><span class="line" line="15"><span class="sVt8B">  ],
</span></span><span class="line" line="16"><span class="sj4cs">  &quot;adjacents&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="17"><span class="sVt8B">    {
</span></span><span class="line" line="18"><span class="sj4cs">      &quot;from_stop_id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;stop_id&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="19"><span class="sj4cs">      &quot;to_stop_id&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;adjacent_stop_id&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="20"><span class="sj4cs">      &quot;time&quot;</span><span class="sVt8B">: </span><span class="sj4cs">123</span><span class="sVt8B">,
</span></span><span class="line" line="21"><span class="sj4cs">      &quot;path&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="22"><span class="sVt8B">        {
</span></span><span class="line" line="23"><span class="sj4cs">          &quot;lat&quot;</span><span class="sVt8B">: </span><span class="sj4cs">48.123</span><span class="sVt8B">,
</span></span><span class="line" line="24"><span class="sj4cs">          &quot;lon&quot;</span><span class="sVt8B">: </span><span class="sj4cs">2.123
</span></span><span class="line" line="25"><span class="sVt8B">        }
</span></span><span class="line" line="26"><span class="sVt8B">      ]
</span></span><span class="line" line="27"><span class="sVt8B">    }
</span></span><span class="line" line="28"><span class="sVt8B">  ],
</span></span><span class="line" line="29"><span class="sj4cs">  &quot;stops_unique&quot;</span><span class="sVt8B">: [
</span></span><span class="line" line="30"><span class="sVt8B">    {
</span></span><span class="line" line="31"><span class="sj4cs">      &quot;name&quot;</span><span class="sVt8B">: </span><span class="sZZnC">&quot;stop_name&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="32"><span class="sj4cs">      &quot;lat&quot;</span><span class="sVt8B">: </span><span class="sj4cs">48.123</span><span class="sVt8B">,
</span></span><span class="line" line="33"><span class="sj4cs">      &quot;lon&quot;</span><span class="sVt8B">: </span><span class="sj4cs">2.123
</span></span><span class="line" line="34"><span class="sVt8B">    }
</span></span><span class="line" line="35"><span class="sVt8B">  ]
</span></span><span class="line" line="36"><span class="sVt8B">}
</span></span></code><!--]--></pre><p><!--[-->J&#39;ai l&#39;impression qu&#39;avec √ßa je peux r√©pondre √† tout ce que je veux faire.<!--]--></p><p><!--[-->Pour ce qui est d&#39;int√©ragir avec la base de donn√©es, je fais un combo dont j&#39;ai l&#39;habitude :
<code><!--[-->knex<!--]--></code> et
<code><!--[-->pg<!--]--></code>.<!--]--></p><p><!--[-->En moins d&#39;1 minute avec un copier/coller d&#39;un autre projet, j&#39;ai quelque chose d&#39;op√©rationnel.<!--]--></p><p><!--[-->J&#39;enchaine ensuite, avec la cr√©ation de la migration, je m&#39;aide du sch√©ma de MobilityDB, je demande √† Mistral en Local
de me le convertir en knex schema builder. Cela fonctionne plut√¥t bien.<!--]--></p><p><!--[-->Pour les donn√©es, je cr√©e des fonctions en TDD pour ins√©rer les donn√©es. Puis, j&#39;essaie de parser le csv en stream pour
les ins√©rer en base. Cela ne fonctionne pas comme je veux je regarderai demain.<!--]--></p><h2 id="ressources"><a href="#ressources"><!--[-->Ressources<!--]--></a></h2><ul><!--[--><li><!--[--><a href="https://docs.mobilitydb.com/MobilityDB-workshop/master/ch04.html#idp22" rel="nofollow"><!--[-->Managing GTFS Data - MobilityDB<!--]--></a><!--]--></li><!--]--></ul><style>html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}</style></div></article><!--]--><footer class="fixed bottom-5 left-1/2 transform -translate-x-1/2 text-gray-500 dark:text-gray-400 text-sm bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg px-4 py-1 rounded-full shadow max-w-[calc(100%-2rem)] z-10 transition-colors duration-300 flex items-center justify-center gap-1 flex-nowrap whitespace-nowrap"> ¬© 2025 <a href="https://github.com/VincentHardouin/metro-travel" class="hover:underline">Metro Travel</a> ‚Äì par <a href="https://vincenthardouin.dev" class="hover:underline">Vincent Hardouin</a></footer></body></div></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/blog/2024-03-26/_payload.json?d002b2d4-7063-42d0-8888-5547bfabd298">[{"state":1,"once":3,"_errors":4,"serverRendered":6,"path":7,"prerenderedAt":8},["Reactive",2],{},["Set"],["ShallowReactive",5],{"/blog/2024-03-26":-1},true,"/blog/2024-03-26",1752417582969]</script><script>window.__NUXT__={};window.__NUXT__.config={public:{content:{wsUrl:""},mdc:{components:{prose:true,map:{}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}}},app:{baseURL:"/",buildId:"d002b2d4-7063-42d0-8888-5547bfabd298",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>